<div class="form-field-container">
    <ng-container *ngTemplateOutlet="renderControl; context: { control: control, parentGroup: parentGroup }">
    </ng-container>

    <ng-template #renderControl let-control="control" let-parentGroup="parentGroup">
        <ng-container [ngSwitch]="control.type">
            <div *ngSwitchCase="'group'" [formGroup]="parentGroup" class="nested-group">
                <h4 class="groupLable">{{ control.label }}</h4>
                <ng-container *ngFor="let nestedControl of control.controls">
                    <ng-container *ngTemplateOutlet="
                      renderControl;
                      context: {
                        control: nestedControl,
                        parentGroup: parentGroup.get(control.label)
                      }
                    "></ng-container>
                </ng-container>
            </div>

            <div class="nested-field form-input" *ngSwitchCase="'text'" [formGroup]="parentGroup">
                <label class="label">{{ control.label }}</label>
                <input class="form-input-field" type="text" [formControlName]="control.label" />
            </div>

            <div class="nested-field form-check" *ngSwitchCase="'checkbox'" [formGroup]="parentGroup">
                <input class="form-check-input" type="checkbox" [formControlName]="control.label" />
                <label class="label">{{ control.label }}</label>
            </div>
            <div class="nested-field" *ngSwitchCase="'text-array'" [formGroup]="parentGroup">
                <label class="label form-select-label ">{{ control.label }}</label>
                <select [formControlName]="control.label" class="form-select">
                    <option *ngFor="let option of control.value">
                        {{ option }}
                    </option>
                </select>
            </div>

            <div *ngSwitchCase="'array'" class="nested-array">
                <div [formGroup]="parentGroup">
                    <h4 class="groupLable">{{ control.label }}</h4>
                    <div [formArrayName]="control.label">
                        <div *ngFor="let itemControls of control.controls; let i = index" [formGroupName]="i">
                            <div *ngFor="let itemControl of itemControls">
                                <ng-container *ngTemplateOutlet="
                            renderControl;
                            context: {
                              control: itemControl,
                              parentGroup: parentGroup.get(control.label).at(i)
                            }
                          "></ng-container>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </ng-template>
</div>